#!/bin/bash -e

repolist=(emp_swift qpid*)

FETCH=false
GITK=false
while [ -n "$1" ]
do
   cmd=$1
   shift
   case $cmd in
      "fetch")
         FETCH=true
         ;;
      "gitk")
         GITK=true
         ;;
      *)
         branch=$cmd
         break
         ;;
   esac
done

if [ -n "$1" ]
then
   echo "Multiple branches or unrecognized commands found" >&2
   exit 1
fi

if [ -z "$branch" ]
then
   echo "No branch specified" >&2
   exit 1
fi

for repo in "${repolist[@]}"
do
   $FETCH && (cd $repo && git fetch) >/dev/null
   ls $repo/.git/refs/remotes/origin/$branch 2>/dev/null || continue
   $GITK && (cd $repo && gitk origin/$branch &)
done
